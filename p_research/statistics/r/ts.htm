<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" xml:lang="es" lang="es" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<!-- METADATOS -->
		<title>Juan Antonio Breña Moral, ICAI, Ingeniero en Organizacion Industrial, Ingeniero Técnico en Informática de gestion</title>
		<meta name="title" content="Juan Antonio Breña Moral, ICAI, Ingeniero en Organizacion Industrial, Ingeniero Técnico en Informática de gestion">
		<meta name="DC.Title" content="Juan Antonio Breña Moral, ICAI, Ingeniero en Organizacion Industrial, Ingeniero Técnico en Informática de gestion">
		<meta http-equiv="title" content="Juan Antonio Breña Moral, ICAI, Ingeniero en Organizacion Industrial, Ingeniero Técnico en Informática de gestion">

		<!-- KEYWORDS -->
		<meta name="keywords" content="Juan Antonio Breña Moral, Breña, Ingeniero en Organizacion Industrial, Organizacion Industrial, ICAI, ICADE, Universidad Pontificia de Comillas, Madrid, Cuenca, Marketing, R, Stat Engine, Desarrollo Web, Consultoria Web, XML, LAMP, J2EE, .NET, Data Mining, Mineria de Datos, Analisis de datos, SAS, SPSS, Web, Paginas web, Direccion de empresas">
		<meta http-equiv="keywords" content="Juan Antonio Breña Moral, Breña, Ingeniero en Organizacion Industrial, Organizacion Industrial, ICAI, ICADE, Universidad Pontificia de Comillas, Madrid, Cuenca, Marketing, R, Stat Engine, Desarrollo Web, Consultoria Web, XML, LAMP, J2EE, .NET, Data Mining, Mineria de Datos, Analisis de datos, SAS, SPSS, Web, Paginas web, Direccion de empresas">

		<!-- DESCRIPCION -->
		<meta name="description" content="Página personal del Ingeniero Juan Antonio Breña Moral. Actualmente investiga en Marketing Avanzado, Dirección de empresas, R y Minería de datos">
		<meta http-equiv="description" content="Página personal del Ingeniero Juan Antonio Breña Moral. Actualmente investiga en Marketing Avanzado, Dirección de empresas, R y Minería de datos">
		<meta http-equiv="DC.Description" content="Página personal del Ingeniero Juan Antonio Breña Moral. Actualmente investiga en Marketing Avanzado, Dirección de empresas, R y Minería de datos">

		<!-- OTROS METADATOS -->
		<meta name="VW96.objecttype" content="Document">
		<META NAME="DC.Language" SCHEME="RFC1766" CONTENT="Spanish">
		<meta name="distribution" content="global">
		<meta name="resource-type" content="document">

		<!-- SEARCH ENGINE -->
		<meta name="robots" content="all">

		<!-- CACHE -->
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="pragma" content="no-cache" />
		<meta http-equiv="expires" content="0" />

		<!-- JAVASCRIPT -->
		<script src="../../../r_javascript/esmeta/loader/LoaderClass_c.js" type="text/javascript" language="JavaScript"></script>
		<script language="JavaScript" type="text/javascript">
			<!--
				// LoaderClass esta basado en la tecnologia Dynapi 2.
				LoaderClass.setLibraryPath('../../../r_javascript/');
				LoaderClass.include('esmeta.forms.ComboManagerClass.js');
				LoaderClass.include('esmeta.helpers.HelperClass.js');
				LoaderClass.include('esmeta.http.requestHttpClass.js');
				LoaderClass.include('esmeta.mvc.WebPageControllerClass.js');
				//LoaderClass.include('esmeta.misc.EmailBuilderClass.js');
				//LoaderClass.include('esmeta.misc.AuthorClass.js');
			// -->
		</script>
		<!-- CARGA DE CLASE QUE MANEJA PAGINA -->
		<script src="RControllerClass.js" type="text/javascript" language="JavaScript"></script>
		<script type="text/javascript" language="JavaScript">
			<!--
				//Web Page Controller Object
				WPCObject = new RControllerClass();
				// Manejo de evento de carga.
				window.onload = WPCObject.window_onLoad;
				// Manejo de evento de errores.
				//window.onerror = WPCObject.window_onError;
			// -->S
		</script>

		<link rel="stylesheet" href="../../../r_css/jab_contents.css" type="text/css" />
		<link rel="stylesheet" href="../../../r_css/typography.css" type="text/css" />

		<!-- ICONO -->
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	</head>
	<body>
		<form name="frmNavigationHelper" id="frmNavigationHelper" action="#">
			<input type="hidden" name="wpSite" id="wpSite" value="Juanantonio.info" />
			<input type="hidden" name="wpArea" id="wpArea" value="R & D" />
			<input type="hidden" name="wpTitle" id="wpTitle" value="R, Stat Server Engine" />
		</form>
		<div align="center" id="frame">
			<!-- NIVEL 1: Logo -->
			<table width="760" cellpadding="0" cellspacing="0" border="0">
				<tr>
					<td class="n1t1f1c1">
						<a href="#" onclick="WPCObject.logo_onClick()" name="top">
							<img src="../../../r_media/imagenes/jabLogo2003.gif" width="207" height="60" alt="" border="0" />
						</a>
					</td>
					<td><img src="../../../r_media/imagenes/pixel_transparente.gif" width="1" height="150" alt="" /></td>
				</tr>
			</table>
			<div id="n2">
				<table width="100%" cellpadding="0" cellspacing="0" border="0">
					<tr>
						<td valign="middle" align="left" class="t1f1c1">
							<span class="t2">
									<script type="text/javascript" language="JavaScript">
										var helperObject = new HelperClass();
										helperObject.writeTitle();
									</script>
							</span>
						</td>
						<td valign="middle" align="right" class="t1f1c2">
							<form action="#" method="post" name="frmNavigation" onsubmit="return WPCObject.frmNavigation_onSubmit(this)">
								<select class="cbNavigation" onchange="WPCObject.cbNavigation_onChange(this)" name="cbNavigation" id="cbNavigation">
									<script type="text/javascript" language="JavaScript">
										WPCObject.writeNavigationSystem();
									</script>
								</select>
							</form>
						</td>
					</tr>
				</table>
			</div>
			<div id="n4">
				<table cellpadding="0" cellspacing="0" border="0" width="100%" class="contenidos">
					<tr>
						<!-- MENU DE NAVEGACION -->
						<td class="MENU_CONTENIDOS">
							<span class="t6">
								<h2>Contents</h2>
								
								<script>
								WPCObject.writeRMenu();
								</script>
								
								<br />
								
								<b><a href="../../research.htm">Go back</a></b>
							</span>
							<!-- <div align="right"><b><a href="../../research.htm">Go back</a></b></div> -->
						</td>
						<td class="t2f2c1" valign="top">
							<span class="t6">
							<h2>ARIMA Time Series predictions using Box-Jenkins approach with R</h2>
<p>
This document shows the way to use R to make predictions with ARIMA models.
The data used in this document, can be downloaded in the following link: 
<a href="http://www.robhyndman.info/TSDL/data/abraham4.dat" target="_blank" onclick="javascript:urchinTracker('/downloads/data_ts')">
http://www.robhyndman.info/TSDL/data/abraham4.dat
</a>
<br/>The file contains Monthly car sales in Quebec 1960-1968. Source: Abraham & Ledolter (1983). 
</p>
<p>
Box-Jenkins Methodology has the following steps to make ARIMA models:

<ol>
	<li><a href="#PLOTS">Identification:</a>
		<ul>
			<li>To find the appropriate values of p and q</li>	
			<li>Correlogram and partial correlogram  </li>
		</ul>
	</li>
	<li><a href="#SELECTION">Estimation:</a> 
		<ul>
			<li>Parameters of the AR and MA</li>
			<li>Linear (OLS) models</li>
			<li>Nonlinear models </li>
		</ul>
	</li>
	<li>Diagnostic checking:
		<ul>
			<li>Check if the residuals from this model are white noise</li>
			<li>Forecasting</li>
		</ul>
	</li>
</ol>
<p>
<b>Note:</b> The piece of code shown in this document appears in a red box while the
 simulation of a R session is shown in a blue box.<br />
</p>
</p>
<IMG SRC="../../../r_media/imagenes/BJApproach.gif" USEMAP="#BJApproach" WIDTH=545 HEIGHT=916 BORDER="0">
<MAP NAME="BJApproach">
     <AREA SHAPE="RECT" HREF="#PLOTS" ALT="Plot Series" COORDS="221,8, 358,80">
     <AREA SHAPE="RECT" HREF="#SELECTION" ALT="Model Selection" COORDS="222,406, 373,496">     
</MAP>


<!-- GO TOP -->
<div align="right"><b><a href="#top">Top</a></b></div>
<a name="PLOTS"></a>
<!-- CONTENTS -->
<h2>I.  Model identification:</h2>
<p>
If you want to know if your data is stationary, you will look up your data.
</p>
<p>
Load this piece of code to see the form of your data.
</p>
<pre>
###################################
# DATA ANALYSIS SCRIPT            #
# Autor: Juan Antonio Breña Moral #
# Email: bren@juanantonio.info    #
###################################

###################################
# R ENGINE SETTINGS               #
###################################

#Sentence written to set working directory
WD <- "C://Documents and Settings/JAB/Escritorio";
setwd(WD);
# make sure working directory is set
getwd();

# set digits
options("digits"=3)

###################################
# ARIMA MODEL SCRIPT              #
###################################

INSTALL_LIBRARIES <- function(){
	install.packages("forecast");
	install.packages("nortest");
	install.packages("quadprog");
	install.packages("zoo");
	install.packages("tseries");
}

#Function used to load libraries
#FORECAST: www-personal.buseco.monash.edu.au/~hyndman/Rlibrary/forecast/
#NORMAL TEST: http://cran.r-project.org/src/contrib/Descriptions/nortest.html
#TIME SERIES: //cran.r-project.org/src/contrib/Descriptions/tseries.html
LOAD_LIBRARIES <- function(){
	library("forecast");
	library("nortest");
	library("tseries");
}
  
# Funcion que genera el mensaje de cabecera.
HEADER <-function(){
cat("\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::");
cat("\n:: SALES PREDICTION | AUTHOR: Juan Antonio Breña Moral          ::");
cat("\n:: VERSION: 2006-06-17 | DOWNLOADS: http://www.juanantonio.info ::");
cat("\n:: EMAIL: bren@juanantonio.info                                 ::");
cat("\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::");
cat("\n:: DESCRIPTION:                                                 ::"):
cat("\n:: Sales Prediction, is a Script to make prediccions. It was    ::");
cat("\n:: designed to control a sales budget in any company  using     ::");
cat("\n:: ARIMA Time Series statistical techniques. The script needs   ::");
cat("\n:: a sales data to start to build a ARIMA model to make a       ::");
cat("\n:: predictions. This script is very useful to design a sales    ::");
cat("\n:: budget in the following exercise and control it. The         ::");
cat("\n:: methodology used to build ARIMA model is Box-Jenkins.        ::");
cat("\n::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\n");
}

TIME_SERIES <- function(DATA,F,S){
    DATOS.TS <- ts(DATA,frequency = F, start = S);
    return(DATOS.TS);
}

JAB.PREDICTION.EDA <- function(DATOS){

	FILE_NAME <- format(Sys.time(), "%X");
	FILE_EXTENSION <- "jpeg";

	#Graphical Output
    par(mfrow= c(2,2));
    plot(DATOS,type="l")
    hist(DATOS, probability =T);
    lines(density(DATOS), col="red");
    qqnorm(DATOS);
    abline(0,1,col="red");
    boxplot(DATOS, horizontal=T);
    par(mfrow= c(1,1)); 
    
}

#FROM: http://tolstoy.newcastle.edu.au/R/help/99b/0171.html
mykurtosis <- function(x) { 
    m4 <- mean((x-mean(x))^4) 
    kurt <- m4/(sd(x)^4)-3 
    kurt 
} 

myskewness <- function(x) { 
    m3 <- mean((x-mean(x))^3) 
    skew <- m3/(sd(x)^3) 
    skew 
} 

JAB.PREDICTION.EDA_TABLE <- function(DATAS){
	COLUMN_NAMES <- c("MEAN","MEDIAN","SD","KURTOSIS","SKEWNESS");
	DATA <- c();
	DATA[1] <- mean(DATAS);
	DATA[2] <- median(DATAS);
	DATA[3] <- sd(DATAS);
	DATA[4] <- mykurtosis(DATAS);
	DATA[5] <- myskewness(DATAS);
	names(DATA) <- COLUMN_NAMES;
	
	print("JAB: EDA VIEW 1.0")
	print(DATA);
	stem(DATAS);
}

JAB.PREDICTION.NORMAL_TESTS <- function(DATAS){
COLUMN_NAMES <- c("SHAPIRO","ANDERSON-DARLING",
"CRAMER-VON MISES","KS","JARQUE-BERA");
	DATA <- c();
	DATA[1] <- shapiro.test(DATAS)$p.value;
	DATA[2] <- ad.test(DATAS)$p.value;
	DATA[3] <- cvm.test(DATAS)$p.value;
	DATA[4] <- lillie.test(DATAS)$p.value;
	DATA[5] <- jarque.bera.test(DATAS)$p.value;
	names(DATA) <- COLUMN_NAMES;
	
	print("JAB: NORMAL TEST TABLE 1.0")
	print(DATA);
}
</pre>
<p>
Enter the data in R system using JGR as R GUI or using RClass.
</p>
<pre class="results">
# To predict anything, you have to get the data
SALES <- scan();
  6550  8728 12026 14395 14587 13791  9498  8251  7049  9545  9364  8456
  7237  9374 11837 13784 15926 13821 11143  7975  7610 10015 12759  8816
 10677 10947 15200 17010 20900 16205 12143  8997  5568 11474 12256 10583
 10862 10965 14405 20379 20128 17816 12268  8642  7962 13932 15936 12628
 12267 12470 18944 21259 22015 18581 15175 10306 10792 14752 13754 11738
 12181 12965 19990 23125 23541 21247 15189 14767 10895 17130 17697 16611
 12674 12760 20249 22135 20677 19933 15388 15113 13401 16135 17562 14720
 12225 11608 20985 19692 24081 22114 14220 13434 13598 17187 16119 13713
 13210 14251 20139 21725 26099 21084 18024 16722 14385 21342 17180 14577

LOAD_LIBRARIES();
JAB.PREDICTION.EDA(SALES);
JAB.PREDICTION.EDA_TABLE(SALES);
JAB.PREDICTION.NORMAL_TESTS(SALES);
</pre>
<a href="ts_images/EDA.jpg" target="blank"><img src="ts_images/EDA.jpg" width="580"/></a>
<pre class="results">
[1] "JAB: EDA VIEW 1.0"
         MEAN        MEDIAN            SD      KURTOSIS      SKEWNESS 
14595.1111111 14076.0000000  4525.2139131    -0.6600995     0.3106385 


   5 | 6
   6 | 6
   7 | 026
   8 | 0035678
   9 | 04455
  10 | 03678999
  11 | 015678
  12 | 012233356788
  13 | 02446788889
  14 | 2344466788
  15 | 1222499
  16 | 11267
  17 | 0122678
  18 | 069
  19 | 79
  20 | 0112479
  21 | 012337
  22 | 011
  23 | 15
  24 | 1
  25 | 
  26 | 1

[1] "JAB: NORMAL TEST TABLE 1.0"
    SHAPIRO ANDERSON-DARLING CRAMER-VON MISES               KS      JARQUE-BERA 
 0.06335382       0.03812055       0.04695266       0.11516182       0.17425073
</pre>
<p>
If you notice, the sales are asymetric. Data fails different tests for normality. <br />
If you test it with normal data sample, you would observe different results. 
</p>
<pre>
NORMAL_SAMPLE <- rnorm(5000);
JAB.PREDICTION.EDA(NORMAL_SAMPLE);
JAB.PREDICTION.EDA_TABLE(NORMAL_SAMPLE);
JAB.PREDICTION.NORMAL_TESTS(NORMAL_SAMPLE);
</pre>
<a href="ts_images/EDA_NORMAL.gif" target="blank"><img src="ts_images/EDA_NORMAL.gif" width="580"/></a>
<pre class="results">
[1] "JAB: EDA VIEW 1.0"
         MEAN        MEDIAN            SD      KURTOSIS      SKEWNESS 
-0.0001047225  0.0006451141  0.9922556060  0.0825848178 -0.0086063633 

  The decimal point is at the |

  -4 | 5
  -4 | 
  -3 | 65
  -3 | 3000
  -2 | 999998877777666666666665
  -2 | 44444444444444333333333322222222222222222221111111111111111111111111+8
  -1 | 99999999999999999999999999999999999888888888888888888888888888888888+173
  -1 | 44444444444444444444444444444444444444444444444444444444444444444444+384
  -0 | 99999999999999999999999999999999999999999999999999999999999999999999+715
  -0 | 44444444444444444444444444444444444444444444444444444444444444444444+785
   0 | 00000000000000000000000000000000000000000000000000000000000000000000+819
   0 | 55555555555555555555555555555555555555555555555555555555555555555555+650
   1 | 00000000000000000000000000000000000000000000000000000000000000000000+439
   1 | 55555555555555555555555555555555555555555555555555555555555555555555+166
   2 | 00000000000000000000011111111111111111222222222222222223333333333344
   2 | 555555555566666666677889999
   3 | 00011114
   3 | 55
   4 | 1

[1] "JAB: NORMAL TEST TABLE 1.0"
    SHAPIRO ANDERSON-DARLING CRAMER-VON MISES               KS      JARQUE-BERA 
  0.4513131        0.5120592        0.6798911        0.6469248        0.4664040 
</pre>
<p>

</p>
<!-- GO TOP -->
<div align="right"><b><a href="#top">Top</a></b></div>
<a name="SELECTION"></a>
<h2>II.  Model estimation and verification:</h2>
<p>

</p>
<pre>
TIME_SERIES <- function(DATA,F,S){
    DATOS.TS <- ts(DATA,frequency = F, start = S);
    return(DATOS.TS);
}

JAB.PREDICTION.BEST_ARIMA <- function(TIME_SERIES){
    DATOS.BEST_ARIMA <- best.arima(DATOS.TS)
    return(DATOS.BEST_ARIMA)
}
</pre>
<pre class="results">
SALES.TS <- TIME_SERIES(SALES,12,1968);
SALES.ARIMA <- JAB.PREDICTION.BEST_ARIMA(SALES.TS);
</pre>
<h2>III.  Forecasting:</h2>
<!-- GO TOP -->
<div align="right"><b><a href="#top">Top</a></b></div>

<h2>Forecasting the future is always difficult...</h2>


<p>
"Computers in the future may weigh no more than 1.5 tons." <br/>
<strong>Popular Mechanics, forecasting the relentless march of science, 1949 </strong>
</p>
<p>
"I think there is a world market for maybe five computers." <br/>
<strong>Chairman of IBM, 1943</strong>
</p>
<p>
"I have traveled the length and breadth of this country and talked with the best people, and I can assure you that data processing is a fad that won't last out the year."<br/>
<strong>The editor in charge of business books for Prentice Hall, 1957</strong>
</p>
<p>
"But what ... is it good for?" <br/>
<strong>Engineer at the Advanced Computing Systems Division of IBM, 1968, commenting on the microchip.</strong>
</p>
<p>
"There is no reason anyone would want a computer in their home." <br/>
<strong>President, Chairman and founder of Digital Equipment Corp., 1977</strong>
</p>
<p>
"This 'telephone' has too many shortcomings to be seriously considered as a means of communication. The device is inherently of no value to us."<br/>
<strong>Western Union internal memo, 1876.</strong>
</p>
<p>
"The wireless music box has no imaginable commercial value. Who would pay for a message sent to nobody in particular?"<br/>
<strong>David Sarnoff's associates in response to his urgings for investment in the radio in the 1920s.</strong>
</p>
<p>
"The concept is interesting and well-formed, but in order to earn better than a 'C,' the idea must be feasible." <br/>
<strong>A Yale University management professor in response to Fred Smith's paper proposing reliable overnight delivery service. (Smith went on to found Federal Express Corp.)</strong>
</p>
<p>
"Who the hell wants to hear actors talk?" <br/>
<strong>Warner Brothers, 1927.</strong>
</p>
<p>
"I'm just glad it'll be Clark Gable who's falling on his face and not Gary Cooper." <br/>
<strong>Gary Cooper on his decision not to take the leading role in "Gone With The Wind."</strong>
</p>
<p>
"A cookie store is a bad idea. Besides, the market research reports say America likes crispy cookies, not soft and chewy cookies like you make."<br/>
<strong>Response to Debbi Fields' idea of starting Mrs. Fields' Cookies.</strong>
</p>
<p>
"We don't like their sound, and guitar music is on the way out." <br/>
<strong>Decca Recording Co. rejecting the Beatles, 1962.</strong>
</p>
<p>
"Heavier-than-air flying machines are impossible." <br/>
<strong>President, Royal Society, 1895.</strong>
</p>
<p>
"If I had thought about it, I wouldn't have done the experiment. The literature was full of examples that said you can't do this." <br/>
<strong>Spencer Silver on the work that led to the unique adhesives for 3-M "Post-It" Notepads.</strong>
</p>
<p>
"So we went to Atari and said, 'Hey, we've got this amazing thing, even built with some of your parts, and what do you think about funding us? Or we' ll give it to you. We just want to do it. Pay our salary, we'll come work for you.' And they said, 'No.' So then we went to Hewlett-Packard, and they said, 'Hey, we don't need you. You haven't got through college yet.'" <br/>
<strong>Apple Computer Inc. founder Steve Jobs on attempts to get Atari and H-P interested in his and Steve Wozniak's personal computer.</strong>
</p>
<p>
"Professor Goddard does not know the relation between action and reaction and the need to have something better than a vacuum against which to react. He seems to lack the basic knowledge ladled out daily in high schools." <br/>
<strong>1921 New York Times editorial about Robert Goddard's revolutionary rocket work.</strong>
</p>
<p>
"You want to have consistent and uniform muscle development across all of your muscles? It can't be done. It's just a fact of life. You just have to accept inconsistent muscle development as an unalterable condition of weight training." <br/>
<strong>Response to Arthur Jones, who solved the "unsolvable" problem by inventing Nautilus. </strong>
</p>
<p>
"Drill for oil? You mean drill into the ground to try and find oil? You're crazy." <br/>
<strong>Drillers who Edwin L. Drake tried to enlist to his project to drill for oil in 1859.</strong>
</p>
<p>
"Stocks have reached what looks like a permanently high plateau." <br/>
<strong>Professor of Economics, Yale University, 1929.</strong>
</p>
<p>
"Airplanes are interesting toys but of no military value."<br/>
<strong>Professor of Strategy, Ecole Superieure de Guerre.</strong>
</p>
<p>
"Everything that can be invented has been invented." <br/>
<strong>Commissioner, U.S. Office of Patents, 1899.</strong>
</p>
<p>
"Louis Pasteur's theory of germs is ridiculous fiction". <br/>
<strong>Professor of Physiology at Toulouse, 1872</strong>
</p>
<p>
"The abdomen, the chest, and the brain will forever be shut from the
intrusion of the wise and humane surgeon." <br/>
<strong>British surgeon, appointed Surgeon-Extraordinary to Queen Victoria 1873.</strong>
</p>
<p>
"640K ought to be enough for anybody." <br/>
<strong> Bill Gates, 1981</strong>
</p>
<!-- GO TOP -->
<div align="right"><b><a href="#top">Top</a></b></div>
							</span>
						</td>
					</tr>
				</table>
			</div>
			<div id="footer">
				<div id="lbFooter">
					<table width="720" cellpadding="0" cellspacing="0" border="0">
						<tr>
							<td align="left" class="t6">
								<script type="text/javascript" language="JavaScript">
									WPCObject.writeFooter();
								</script>							
							</td>
							<td align="right" class="t6">
								<script type="text/javascript" language="JavaScript">
									WPCObject.writeLastModified();
								</script>							
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-343143-1";
urchinTracker();
</script>
	</body>
</html>
