# Today's Practical gives you additional practice using R,
# carrying out EDA, and analysing some data. 

# The data you'll work with is International Vital Statistics (1996) and
# contains information for 57 countries.  There are 10 variables measured on
# each country.  

#---------------------------------------------------------------------------------
#(1) Read the data file into a list object called vital, see what the variable names are,
# and then use the attach() command to make the variables of vital more accessible

vital <- 
 read.table("http://www.stat.auckland.ac.nz/~wild/ChanceEnc/WSdata/Ch02data/vital.txt",
   header=T,row.names="Country")

names(vital)
options(width=100) #prints more columns to the screen, may want to adjust this
vital

#this will link Country names to each variable
for(i in 1:10) names(vital[[i]]) <- row.names(vital)  

# Type is qualitative with 4 levels: 
# (1) Industrial, (2) Africa, (3) SE Asia+Japan+China, (4) Central and 
# South America
# The next 3 variables are infant mortality rates/1000 births: both sexes, males, females
# Then life expectancy in years: both sexes, males, females
# Then Births/1000 people, Deaths/1000 people, Net Migration/1000 people (those entering
#   the country minus those leaving)

attach(vital)

regions <- as.character(type)
regions[type==1] <- "Industrial"
regions[type==2] <- "Africa"
regions[type==3] <- "SE Asia"
regions[type==4] <- "S+C Amer"

#---------------------------------------------------------------------------------
# (2) Some univariate summaries

# (a) Construct stem-and-leaf plots, histograms, and boxplots for mor.both, life.both,
#  births, deaths, and migrants.
#  Examine and describe the shapes of the histograms (skewed?, unimodal?)
#  and check for outliers.

# (b) Which country has the highest infant mortality rate (both sexes combined)?
#   Is it also the country with highest male infant mortality rates? Female?
#   What about the country with the lowest infant mortality rate (both, male, female)?
#   Hint: the sort() command is simplest.

# (c) Which countries have the longest life expectancy (both, female, male)?
#  Which have the shortest?  In which country is there the largest difference
#  between males and females (create a new variable, x <- mor.male-mor.fem)?
#  Do any of these countries have highest/lowest infant mortality rates?

# (d) Which country has the highest Birth rate?  Lowest Birth rate?

# (e) Which country has the highest Death rate?  Lowest Death rate?

# (f) Which countries have the largest positive Net migration? 
#  Largest negative Net migration?

# (g) Construct a new variable, Increase, that gives the net increase in population
#  size/1000 for each country.

# (h) Any other univariate questions you might ask?

#---------------------------------------------------------------------------------
# (3) Some bivariate EDA (quant vs quant)

# (a) What kind of relationship, if any, exists between life expectancy and infant
#  mortality rate?  Use plot(x,y), then identify() command to label interesting obs'ns in
#  a scatterplot. identify(x,y,row.names(vital)) will give the labels. Do you see
#  any interesting patterns between life expectancy, infant mortality, and country?

# (b) Fit a scatterplot smooth to life expectancy as a function of infant mortality.
#  scatter.smooth(mor.both,life.both).  Now how would you describe the relationship
#  between the 2 variables? 

# (c) What is the relationship between male and female infant mortality rates?  
#  You might want to use scatter.smooth() and identify().

# (d) How related are male and female life expectancies?

# (e) What is the relationship between Birth and Death rates?

# (f) What about the relationship between life expectancy and net migration?

# (g) Use pairs(cbind(mor.both,life.both,births,deaths,migrants)) to see if there
#  are any other patterns.

#---------------------------------------------------------------------------------
# (4) More bivariate EDA (qualitative vs quant)
#  Now focus on comparisons between types of countries.  You can use the split()
#  command to divide the data on the basis of types.  Just to see what happens,
#  split(vital,type)

#  (a) Visually compare the 4 types of countries in terms of 5 variables: mor.both, 
#  life.both, births, deaths, migrants using side-by-side boxplots.

type.names <- c("Ind","Afr","SE Asia","CSAm")

par(mfrow=c(2,3))
boxplot(split(mor.both,type),main="Infant Mortality",names=type.names)
boxplot(split(life.both,type),main="Life Expect.",names=type.names)
boxplot(split(births,type),main="Births",names=type.names)
boxplot(split(deaths,type),main="Deaths",names=type.names)
boxplot(split(migrants,type),main="Migrants",names=type.names)

# Which "types" have the highest Infant Mortality?, The lowest?
# Which "types" have the longest Life Expectancy?, The shortest?
# Which "types" have the highest Birth rate?, The lowest?
# Which "types" have the highest Death rate?, The lowest?
# Which "types" have the highest Net Immigration rate?, The lowest?

#  (b) Some fancier plots that show relationships between variables by "type"

# This plot shows life expectancy (Y) vs infant mortality (X) for each "type"
# separately.  Read the plots from bottom left to bottom right, then top left
# to top right with "labels" in the upper panel

 coplot(life.both ~ mor.both | regions)

# What's interesting here?

# repeat with births versus deaths
 coplot(births ~ deaths | regions)

